- hosts: 'ec2'
  tasks:
    - name: 'update apt packages'
      apt:
       update_cache: 'yes'
       force_apt_get: 'yes'
      become: true
    
    - name: Install packages needed for Docker
      apt:
       name: "{{ DOCKER_PACKAGES }}"
       state: present
       force_apt_get: "yes"
      become: true

    - name: Add Docker GPG apt Key
      apt_key:
       url: https://download.docker.com/linux/ubuntu/gpg
       state: present
      become: true

    - name: 'Get current OS release version into a variable'
      shell: lsb_release -cs
      register: OS_RELEASE_VERSION

    - name: Add Docker Repository
      apt_repository:
       repo: "deb [arch=amd64] https://download.docker.com/linux/ubuntu bionic stable"
       state: present
      become: true
    - name: Update apt and install docker-ce
      apt: 
       update_cache: yes 
       name: docker-ce 
       state: latest
      become: true
    - name: "Add docker group"
      group:
       name: "docker"
       state: present

    - name: "Adding user to docker group"
      user:
        name: "{{ USER_NAME }}"
        groups: "docker"
        append: "yes"
        
    - name: "Install python dependencies"
      apt:
       update_cache: yes
       state: latest
       name: python3-pip
      become: true

    - name: "Install Docker sdk for python"
      pip:
       name: docker
    
